<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add/Edit</title>
    <link rel="stylesheet" href="/css/style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="icon" href="/Imagenes/Logo/Logo.png">
</head>

<body>
    {{> header}}
    <div class="container mt-5">
        <div class="row">
            <div class="col-12 col-md-8 offset-md-2">
                <h2 class="mb-4">Add/Edit film</h2>
                
                <form id="filmForm" role="form" class="needs-validation" novalidate
                    action="{{#editing}}/editFilm/{{film._id}}{{/editing}}{{^editing}}/addFilm{{/editing}}"
                    enctype="multipart/form-data">
                    
                    <input type="hidden" id="isEditing" value="{{#editing}}true{{/editing}}{{^editing}}false{{/editing}}">
                    <input type="hidden" id="currentFilmId" value="{{film._id}}">

                    <div class="mb-3 form-group">
                        <label for="title" class="form-label">Title of the film</label>
                        <input type="text" class="form-control" id="title" name="title"
                            placeholder="Add the title of the film" value="{{film.title}}" required pattern="[A-Z].*">
                        
                        <div class="invalid-feedback">
                            Title is required and must start with an uppercase letter.
                        </div>
                        <div id="title-error-server" class="invalid-feedback" style="display:none">
                            This title already exists in the database.
                        </div>
                    </div>

                    <div class="mb-3 form-group">
                        <label for="description" class="form-label">Description</label>
                        <textarea class="form-control" id="description" name="description" rows="3"
                            placeholder="Add the description of the film" required>{{film.description}}</textarea>
                        <div class="invalid-feedback">
                            Please provide a description.
                        </div>
                    </div>

                    <div class="mb-3 form-group">
                        <label for="cover" class="form-label">Cover Image (Poster):</label>
                        <input class="form-control" type="file" id="cover" name="cover" accept="image/*" {{^editing}}required{{/editing}}>
                        <div class="invalid-feedback">
                            Cover image is required.
                        </div>
                    </div>

                    <div class="mb-3 form-group">
                        <label for="titlePhoto" class="form-label">Title Image (Logo):</label>
                        <input class="form-control" type="file" id="titlePhoto" name="titlePhoto" accept="image/*" {{^editing}}required{{/editing}}>
                        <div class="invalid-feedback">Logo image is required.</div>
                    </div>

                    <div class="mb-3 form-group">
                        <label for="filmPhoto" class="form-label">Film Image (General Still):</label>
                        <input class="form-control" type="file" id="filmPhoto" name="filmPhoto" accept="image/*" {{^editing}}required{{/editing}}>
                        <div class="invalid-feedback">Film image is required.</div>
                    </div>

                    <div class="mb-3 form-group">
                        <label for="releaseYear" class="form-label">Release year</label>
                        <input type="number" class="form-control" id="releaseYear" name="releaseYear"
                            placeholder="Add the release year" value="{{film.releaseYear}}" required min="1888">
                        <div class="invalid-feedback">
                            Please provide a valid release year.
                        </div>
                    </div>

                    <div class="mt-5 mb-5 checkbox">
                        <label class="form-label d-block">Gender (Select at least one):</label>
                        <div class="btn-group" role="group" aria-label="Gender toggle buttons" id="genreGroup">
                            <input type="checkbox" class="btn-check" id="action" name="genre" value="Action" autocomplete="off" {{#film.isAction}}checked{{/film.isAction}}>
                            <label class="btn btn-outline-primary" for="action">Action</label>
                            
                            <input type="checkbox" class="btn-check" id="comedy" name="genre" value="Comedy" autocomplete="off" {{#film.isComedy}}checked{{/film.isComedy}}>
                            <label class="btn btn-outline-primary" for="comedy">Comedy</label>
                            
                            <input type="checkbox" class="btn-check" id="horror" name="genre" value="Horror" autocomplete="off" {{#film.isHorror}}checked{{/film.isHorror}}>
                            <label class="btn btn-outline-primary" for="horror">Horror</label>
                            
                            <input type="checkbox" class="btn-check" id="scifi" name="genre" value="Science-Fiction" autocomplete="off" {{#film.isScifi}}checked{{/film.isScifi}}>
                            <label class="btn btn-outline-primary" for="scifi">Science-Fiction</label>
                            
                            <input type="checkbox" class="btn-check" id="fantasy" name="genre" value="Fantasy" autocomplete="off" {{#film.isFantasy}}checked{{/film.isFantasy}}>
                            <label class="btn btn-outline-primary" for="fantasy">Fantasy</label>
                            
                            <input type="checkbox" class="btn-check" id="adventure" name="genre" value="Adventure" autocomplete="off" {{#film.isAdventure}}checked{{/film.isAdventure}}>
                            <label class="btn btn-outline-primary" for="adventure">Adventure</label>
                            
                            <input type="checkbox" class="btn-check" id="adventure2" name="genre" value="Other" autocomplete="off" {{#film.isOtherGenre}}checked{{/film.isOtherGenre}}>
                            <label class="btn btn-outline-primary" for="adventure2">Other</label>
                        </div>
                        <div id="genre-error" class="text-danger mt-2" style="display:none; font-size: 0.875em;">
                            Please select at least one genre.
                        </div>
                    </div>

                    <div class="mb-3 form-group">
                        <label for="rating" class="form-label">Calification</label>
                        <input type="number" class="form-control" id="rating" name="rating"
                            placeholder="Add the calification (0-5)" min="0" max="5" step="0.5" value="{{film.rating}}" required>
                        <div class="invalid-feedback">Rating must be between 0 and 5.</div>
                    </div>

                    <div class="mb-3 form-group">
                        <label for="edad" class="form-label">Age classification</label>
                        <input type="text" class="form-control" id="edad" name="ageClassification"
                            placeholder="Add the age classification" value="{{film.ageClassification}}" required>
                        <div class="invalid-feedback">Age classification is required.</div>
                    </div>

                    <div class="mb-3 form-group">
                        <label for="director" class="form-label">Director</label>
                        <input type="text" class="form-control" id="director" name="director"
                            placeholder="Add the director" value="{{film.director}}" required>
                        <div class="invalid-feedback">Director name is required.</div>
                    </div>

                    <div class="mb-3 form-group">
                        <label for="fotoDirector" class="form-label">Image of the director:</label>
                        <input class="form-control" type="file" id="fotoDirector" name="fotoDirector" accept="image/*" {{^editing}}required{{/editing}}>
                        <div class="invalid-feedback">Director photo is required.</div>
                    </div>

                    <div class="mb-3 form-group">
                        <label class="form-label">Cast (At least Actor 1 required)</label>
                        
                        <div class="mb-2">
                            <label for="actor1" class="form-label text-muted small">First actor Name</label>
                            <input type="text" class="form-control mb-1" id="actor1" name="cast"
                                placeholder="Name" value="{{film.cast.0}}" required>
                            <input class="form-control" type="file" id="fotoActor1" name="fotoActor1" accept="image/*" {{^editing}}required{{/editing}}>
                            <div class="invalid-feedback">First actor name and photo are required.</div>
                        </div>

                        <div class="mb-2 mt-3">
                            <label for="actor2" class="form-label text-muted small">Second actor Name (Optional)</label>
                            <input type="text" class="form-control mb-1" id="actor2" name="cast"
                                placeholder="Name" value="{{film.cast.1}}">
                            <input class="form-control" type="file" id="fotoActor2" name="fotoActor2" accept="image/*">
                        </div>

                        <div class="mb-2 mt-3">
                            <label for="actor3" class="form-label text-muted small">Third actor Name (Optional)</label>
                            <input type="text" class="form-control mb-1" id="actor3" name="cast"
                                placeholder="Name" value="{{film.cast.2}}">
                            <input class="form-control" type="file" id="fotoActor3" name="fotoActor3" accept="image/*">
                        </div>
                    </div>

                    <div class="mb-3 form-group">
                        <label for="duration" class="form-label">Duration (hours, minutes)</label>
                        <input type="text" class="form-control" id="duration" name="duration"
                            placeholder="Add the duration in hours,minutes" value="{{film.duration}}" required>
                        <div class="invalid-feedback">Duration is required.</div>
                    </div>

                    <div class="mt-5 checkbox">
                        <label class="form-label">Language:</label>
                        <div class="btn-group" role="group" aria-label="Language toggle buttons">
                            <input type="checkbox" class="btn-check" id="english" name="language" value="English" autocomplete="off" {{#film.isEnglish}}checked{{/film.isEnglish}}>
                            <label class="btn btn-outline-success" for="english">English</label>
                            
                            <input type="checkbox" class="btn-check" id="spanish" name="language" value="Spanish" autocomplete="off" {{#film.isSpanish}}checked{{/film.isSpanish}}>
                            <label class="btn btn-outline-success" for="spanish">Spanish</label>
                            
                            <input type="checkbox" class="btn-check" id="french" name="language" value="French" autocomplete="off" {{#film.isFrench}}checked{{/film.isFrench}}>
                            <label class="btn btn-outline-success" for="french">French</label>
                            
                            <input type="checkbox" class="btn-check" id="german" name="language" value="German" autocomplete="off" {{#film.isGerman}}checked{{/film.isGerman}}>
                            <label class="btn btn-outline-success" for="german">German</label>
                            
                            <input type="checkbox" class="btn-check" id="german2" name="language" value="Other" autocomplete="off" {{#film.isOtherLanguage}}checked{{/film.isOtherLanguage}}>
                            <label class="btn btn-outline-success" for="german2">Other</label>
                        </div>
                    </div>

                    <div class="mb-5 mt-5">
                        <button type="submit" class="btn btn-primary" id="submitBtn">
                            <span id="btnText">{{#editing}}Update Film{{/editing}}{{^editing}}Add Film{{/editing}}</span>
                            <span id="btnSpinner" class="spinner-border spinner-border-sm" role="status" aria-hidden="true" style="display:none;"></span>
                            <span id="btnLoadingText" style="display:none;">Processing...</span>
                        </button>
                        <a href="/indice" class="btn btn-secondary" role="button">Cancel</a>
                    </div>

                </form>
            </div>
        </div>
    </div>

    <div class="modal fade" id="resultModal" tabindex="-1" aria-labelledby="modalTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">Notification</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center" id="modalBody">
                    </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <a href="/indice" id="btnRedirect" class="btn btn-primary" style="display:none;">Go to Index</a>
                </div>
            </div>
        </div>
    </div>

    {{> footer}}

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/app.js"></script>
</body>

</html>